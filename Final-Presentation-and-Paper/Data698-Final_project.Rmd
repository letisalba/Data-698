---
title: "Data 698 - Final Project"
author: "Leticia Salazar"
date: "May 17, 2023"
output:
  html_document:
    theme: united
    highlight: kate
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

$~$

# [Polycystic Ovarian Syndrome (PCOS)]()

$~$

## Overview: 

Polycystic Ovary Syndrome (PCOS) stands as one of the most prevalent endocrine disorders affecting reproductive-aged women globally. This complex condition disrupts hormone levels within the body, impacting the ovaries and often leading to a myriad of symptoms. PCOS is characterized by a spectrum of irregularities, including menstrual irregularities, hormonal imbalances, and the formation of cysts on the ovaries. Its manifestation varies among individuals, typically marked by excessive production of androgens, irregular menstrual cycles, and difficulties in ovulation, potentially leading to fertility challenges. Beyond reproductive health concerns, PCOS also presents with metabolic implications, such as insulin resistance, which can elevate the risk of developing type 2 diabetes and cardiovascular issues. The exact cause of PCOS remains multifaceted and isn't singularly defined, encompassing a combination of genetic, hormonal, and lifestyle factors. As a chronic disorder, PCOS poses significant challenges to those affected, impacting their overall health and quality of life.

This syndrome's diagnosis is often challenging due to its diverse array of symptoms and the absence of a singular definitive test. Clinicians typically rely on a set of diagnostic criteria, such as irregular menstrual cycles, elevated androgen levels, and the presence of ovarian cysts, to identify and evaluate PCOS. However, the complexity of this condition extends beyond its diagnostic challenges, as managing PCOS necessitates a multifaceted approach. Treatment strategies often focus on alleviating specific symptoms, such as irregular periods, infertility, and excessive hair growth, through medications, lifestyle modifications, and sometimes surgical interventions. Additionally, lifestyle changes involving diet adjustments and regular exercise play a crucial role in managing the metabolic aspects of PCOS. Research into PCOS continues to expand, aiming to enhance diagnostic accuracy, refine treatment approaches, and deepen our understanding of its underlying mechanisms to better support individuals grappling with this pervasive syndrome.

Hormones that are involved in PCOS are:

* **Androgens: ** aka "male hormones" are present in women with PCOS at higher levels than usual. Excess in androgens can cause symptoms such as acne, unwanted hair, thinning hair, and irregular periods.

* **Insulin: ** allows the body to absorb glucose (blood sugar) into the cells for energy. In PCOS, the body doesn't respond to insulin as intended therefore, elevations in blood glucose levels can be assessed. Such elevations then lead to increased production of androgen.

* **Progesterone: ** vital hormone for menstruation and pregnancy; lack of progesterone contributes to irregular periods.

$~$

PCOS Symptoms:

Many of these symptoms can be attributed to other causes or go unnoticed but it is very common for PCOS to go undiagnosed for some time. Here are some symptoms that help with the diagnosis:

* **Irregular periods: ** irregular or missed periods as are a result of not ovulating is a common signs of PCOS

* **Polycystic ovaries: ** some may develop cysts in their ovaries but some don't. Ovaries may be enlarged and follicles surrounding their eggs therefore failing to function regularly.

* **Excess androgen: ** elevated levels of male hormones can cause excess hair and acne.

$~$

Other symptoms may include:

* **Weight gain: ** many people with PCOS will have weight gain or obesity that is difficult to manage.

* **Fatigue: ** increase in fatigue or low energy is also common

* **Unwanted hair growth: ** due to excess androgen, areas such as face, arms, back, chest, hand, toes and abdomen may have excess hair growth.

* **Thinning hair on the head: ** hair loss may increase in middle age for those with PCOS

* **Infertility: ** PCOS is a leading cause for infertility but not everyone is the same.

* **Acne: ** due to hormonal changes, acne can be arise and make skin oilier than usual and cause breakout in the face, chest and upper back.

* **Darkening of skin: ** areas such as under arms, breasts or back of your neck may get dark, patchy or thicken

* **Mood changes: ** mood swings, depression and anxiety can increase

* **Pelvic pain: ** pain may occur with periods along with heavy bleeding or without bleeding

* **Headaches: ** can occur due to hormonal changes

* **Sleep problems: ** most people often suffer with problem such as insomnia or poor sleep. These arise due to many factors but a common one is having sleep apnea (sleep disorder). Even when you fall asleep you wake up as if you have not slept at all or have trouble falling asleep.

* **Depression: ** can arise due to symptoms that can alter your appearance and have a negative impact on your emotions.

**It's good to note that not everyone who is diagnosed with PCOS experiences all of these symptoms and should always consult with a their PCP or OBGYN to get an accurate diagnosis.**

$~$

## The Problem:

Early identification of risk factors associated with PCOS can assist in timely interventions and lifestyle adjustments. Tailoring suggestions or treatments based on individualized risk profiles has the potential to enhance patient outcomes. Employing predictive models can play a pivotal role in increasing awareness regarding PCOS risk factors and preventive measures. However, limitations may exist in accessing comprehensive and varied datasets containing accurate demographic, clinical, and lifestyle data. It is crucial to ensure the model's transparency and interpretability to facilitate well-informed decisions and recommendations. Additionally, it's imperative that the model demonstrates proficiency across diverse demographic groups and populations. Addressing these challenges involves the development of a robust predictive model using machine learning techniques. Such an endeavor holds the promise of significantly contributing to the identification of individuals at risk of PCOS, thereby enabling early interventions and guiding personalized healthcare strategies for improved management of the condition. This project will investigate publicly available datasets that will be used to develop machine learning models that predicts the probability or risk of an individual having or developing PCOS based on demographic information (age, ethnicity, geographical location), clinical data (hormonal levels, BMI, menstrual irregularities), and lifestyle factors (dietary habits, exercise routine, stress levels).


$~$

## The Data:

The Polycystic ovary syndrome (PCOS) dataset, available on [Kaggle.com](https://www.kaggle.com/datasets/prasoonkottarathil/polycystic-ovary-syndrome-pcos), is comprised of two csv files labeled `PCOS_data_without_infertility` and `PCOS_infertility`. In total, these files encompass 48 variables and 541 data entries all collected from 10 different hospitals across Kerala, India. The dataset contains all physical and clinical parameters to determine PCOS and infertility related issues.

**Full description of the variables below:**

* Units used range from imperial to metric system of measurement

* For Yes | No questions
  * Yes = 1
  * No = 0

Variables                               Description
----------------------------            ---------------------------------------
"Sl..No"                                unique identification number assigned to each entry
"Patient.File.No."                      file number for each patient's record.       
"PCOS..Y.N."                            indicates the presence or absence of PCOS, with "Y" denoting "1 or Yes" and "N" for "0 or No."
"I...beta.HCG.mIU.mL."                  pregnancy hormone case I measured in milli-international units per liter (mIU/L)
"II....beta.HCG.mIU.mL."                pregnancy hormone case II measured in milli-international units per liter (mIU/L)
"AMH.ng.mL."                            detects ovarian reserve (egg count)           
"Age..yrs."                             age of patient in years            
"Weight..Kg."                           weight of patient in kg            
"Height.Cm."                            height of patient in cm            
"BMI"                                   body mass index                    
"Blood.Group"                           Blood Groups: A+ = 11, A- = 12, B+ = 13, B- = 14, O+ = 15, O- = 16, AB+ = 17, AB- = 18            
"Pulse.rate.bpm."                       beats per minute       
"RR..breaths.min."                      respiration rates per minute       
"Hb.g.dl."                              hemoglobin concentration measured in grams per deciliter (g/dL).               
"Cycle.R.I."                            cycle Regularity Index used to assess the regularity or irregularity of menstrual cycles in women: 4 indicates irregular menstrual cycle, 2 indicates a regular menstrual cycle           
"Cycle.length.days."                    length of menstrual cycle     
"Marraige.Status..Yrs."                 years married  
"Pregnant.Y.N."                         pregnant yes or no         
"No..of.aborptions"                     number of abortions      
"FSH.mIU.mL."                           follicle stimulating hormone measured in milli-international units per liter (mIU/L)            
"LH.mIU.mL."                            luteinizing hormone (increases during ovulation) measured in milli-international units per liter (mIU/L)             
"FSH.LH"                                ratio between Follicle-Stimulating Hormone (FSH) and Luteinizing Hormone (LH)                
"Hip.inch."                             measurement of hips in inches              
"Waist.inch."                           measurement of waist in inches            
"Waist.Hip.Ratio"                       ratio of measurement of waist and hip       
"TSH..mIU.L."                           thyroid stimulating hormone measured in milli-international units per liter (mIU/L)           
"AMH.ng.mL."                            Anti-MÃ¼llerian Hormone (AMH) measured in nanograms per milliliter (ng/mL); a marker used in reproductive medicine to assess ovarian reserve             
"PRL.ng.mL."                            Prolactin measured in nanograms per milliliter (ng/mL); a hormone produced by the pituitary gland           
"Vit.D3..ng.mL."                        Vitamin D3 measured in nanograms per milliliter (ng/mL); is essential for bone health, immune function, and various other bodily processes.         
"PRG.ng.mL."                            Progesterone measured in nanograms per milliliter (ng/mL); a hormone involved in the menstrual cycle, pregnancy, and maintaining the uterine lining for a developing embryo.             
"RBS.mg.dl."                            Random Blood Sugar measured in milligrams per deciliter (mg/dL); it represents the level of glucose (sugar) present in the blood at a random time, without fasting.            
"Weight.gain.Y.N."                      weight gain yes or no       
"hair.growth.Y.N."                      hair growth yes or no (hirsutism)       
"Skin.darkening..Y.N."                  darkening of skin yes or no  
"Hair.loss.Y.N."                        hair loss yes or no         
"Pimples.Y.N."                          pimples (acne) yes or no           
"Fast.food..Y.N."                       consumption of fast food yes or no    
"Reg.Exercise.Y.N."                     regularly exercise yes or no                 
"BP._Systolic..mmHg."                   systolic blood pressure measured in millimeters of mercury (mmHg).     
"BP._Diastolic..mmHg."                  diastolic blood pressure measured in millimeters of mercury (mmHg)  
"Follicle.No...L."                      number of follicles on left ovary       
"Follicle.No...R."                      number of follicles in right ovary       
"Avg..F.size..L...mm."                  average size of follicles in left ovary measured in millimeters (mm)  
"Avg..F.size..R...mm."                  average size of follicles in right ovary measured in millimeters (mm)  
"Endometrium..mm."                      size of the endometrial thickness in millimeters (mm)      

$~$

### Load Libraries:

The following libraries were utilized in this assignment:

```{r, warning=FALSE, message=FALSE, cache=FALSE, comment=FALSE}
# load libraries
library(tidyverse) # data prep
library(DataExplorer) # histograms for datasets
library(skimr) # data prep
library(rpart) # decision tree package
library(rpart.plot) # decision tree display package
library(kableExtra) # kable function for tables 
library(knitr) # kable function for table
library(tidyr) # splitting data
library(ggplot2) # graphing
library(hrbrthemes) # chart customization
library(gridExtra) # layering charts
library(stringr) # data prep
library(tidymodels) # predictions
library(corrplot) # correlation plot
library(randomForest) # for the random forest
library(caret) # confusion matrix
library("e1071") #svm
library(formattable) 
library(corrplot) # correlation plot
library(caret) # confusion matrix
library(neuralnet) # neural network
library(stats) # linear and logistic regression
library(gbm) # generalized boosted models
library(xgboost) # extreme gradient boosting
library(kknn) # weighted k-Nearest neighbors
library(jtools)  # use of summ()
#library(class)
```

$~$

### Load data:

The dataset selected has been incorporated into my [GitHub](https://github.com/letisalba/Data-698/tree/master/Data-Collection-and-Analysis) and imported into R.

```{r, echo=FALSE}
# load the dataset from github
pcos <- read.csv("https://raw.githubusercontent.com/letisalba/Data-698/master/Data-Collection-and-Analysis/csv/PCOS_infertility.csv")
pcos2 <- read.csv("https://raw.githubusercontent.com/letisalba/Data-698/master/Data-Collection-and-Analysis/csv/PCOS_without_infertility.csv")
```

$~$

Displaying the `pcos` data:
```{r, echo=FALSE, kable.opts=list(caption="data frame is now printed using `kable`.")}
# display the `pcos` dataset

pcos %>% 
kable(format = "html", col.names = colnames(pcos)) %>%
  kable_styling() %>%
  kableExtra::scroll_box(width = "100%", height = "400px")
```
$~$

Displaying the `pcos2` data:
```{r, echo=FALSE, kable.opts=list(caption="data frame is now printed using `kable`.")}
# display the `pcos2` dataset

pcos2 %>% 
kable(format = "html", col.names = colnames(pcos2)) %>%
  kable_styling() %>%
  kableExtra::scroll_box(width = "100%", height = "400px")
```

$~$

### Data Exploration:

Using the `skimr` library we can obtain a quick summary statistic of the dataset. The first data set `pcos` includes 541 observations and a total of 6 variables. The second data set `pcos2` includes 541 observations and a total of 45 variables. There seems to be no missing values in both datasets but there is a mixture of character and numeric column types that have to be addressed / calculated. Notice that the column names are not clear enough for readers, this will be tackled in the data preparation section.

$~$

Summary of the `pcos` data:
```{r, echo=FALSE}
# summary of the pcos dataset
skim(pcos)
```

$~$

Summary of the `pcos2` data:
```{r, echo=FALSE}
# summary of the pcos2 dataset
skim(pcos2)
```


$~$

Histograms provide valuable visual insights into the distribution patterns within a dataset. With the use of the `Data Explorer` library it allows us to effortlessly generate histograms that showcase the distribution characteristics of the entire dataset, as illustrated below.

$~$

#### `pcos` data:

Upon analyzing the variable distribution, my initial observation indicates that the variables follow a right-skewed distribution. Although the `SI..No` variable exhibits a unimodal distribution, it lacks significance and will be eliminated upon merging both datasets.

```{r, r, fig.height=4, fig.width=6, fig.align='center', warning=FALSE, echo=FALSE, message=FALSE}
DataExplorer::plot_histogram(
  geom_histogram_args = list(alpha = 1, fill = "#7e102c"),
   data = pcos,
         ggtheme=theme_ipsum())
```

$~$

#### `pcos2` data:

Upon visual inspection, no distinct pattern or discernible shape emerges from the histograms for the second dataset as a whole. Similar to the first dataset, `SI..No` and `Patient.File.No.` has a unimodel distribution but plays no significant role in my analysis.

```{r, fig.height = 10, fig.width = 10, fig.align='center', warning=FALSE, echo=FALSE, message=FALSE}
DataExplorer::plot_histogram(
  geom_histogram_args = list(alpha = 1, fill = "#a86800"),
   data = pcos2,
         ggtheme=theme_ipsum())
```

$~$

I would like to further examine these variables but not before preparing the data set to ensure all variables are accounted for especially for `BMI`, `FSH.LH` and `Waist.Hip.Ratio`.

$~$

### Data Preparation:

My data preparation primarily involves column renaming and addressing missing values. This includes handling missing values by employing mean, median, or mode replacement strategies for columns like `Marriage Status (Yrs)` and `Fast Food (Y/N)`. Additionally, for columns such as `BMI`, `FSH.LH`, and `Waist.Hip.Ratio`, I will compute overall values. Specific columns will be converted to the metric system, and redundant or unnecessary columns will be removed. These steps aim to streamline data management before merging the two datasets.

$~$

Prior to commencing the cleaning process, I standardized the datasets to numeric format due to variations in the class of certain variables.

```{r, echo=FALSE, warning=FALSE}
pcos <- mutate_all(pcos, function(x) as.numeric(as.character(x)))
pcos2 <- mutate_all(pcos2, function(x) as.numeric(as.character(x)))
```

$~$

From the `skimr` summary it was noted that there were no missing values but there was an error in the computational values of certain columns. Below is the initial count of missing values for each data set:

`pcos` dataset:

```{r, echo=FALSE}
# missing data
colSums(is.na(pcos))
```
$~$

`pcos2` dataset:
```{r, echo=FALSE}
# missing data
colSums(is.na(pcos2))
```

```{r, echo=FALSE, eval=FALSE}
colnames(pcos)
```

```{r, echo=FALSE, eval=FALSE}
colnames(pcos2)
```
$~$



```{r, echo=FALSE}
# removing first two column for `pcos` data
pcos <- dplyr::select(pcos, -c(2:6))

# renaming columns for `pcos` data
pcos <- pcos %>% 
  rename("Sl.No" = "Sl..No")

# removing columns not needed for `pcos_infertility` data
pcos2 <- dplyr::select(pcos2, -c(2, 45))

# renaming columns for `pcos_infertility` data
pcos2 <- pcos2 %>% 
  rename("Sl.No" = "Sl..No",
         "PCOS(Y/N)" = "PCOS..Y.N.",
         "Age(yrs)" = "Age..yrs.",
         "Weight(kg)" = "Weight..Kg.",
         "Height(cm)" = "Height.Cm.",
         "Blood_Group" = "Blood.Group", 
         "Pulse_rate(bpm)" = "Pulse.rate.bpm.",
         "RR(breaths/min)" = "RR..breaths.min.",
         "Hb(g/dl)" = "Hb.g.dl.",
         "Cycle(R/I)" = "Cycle.R.I.",
         "Cycle_length(days)" = "Cycle.length.days.",
         "Married(yrs)" = "Marraige.Status..Yrs.",
         "Pregnant" = "Pregnant.Y.N.",
         "No_of_abortions" = "No..of.aborptions",
         "Ibeta-HCG(mIU/mL)" = "I...beta.HCG.mIU.mL.",
         "IIbeta-HCG(mIU/mL)" = "II....beta.HCG.mIU.mL.",
         "FSH(mIU/mL)" = "FSH.mIU.mL.",
         "LH(mIU/mL)" = "LH.mIU.mL.",
         "FSH-LH" = "FSH.LH",
         "Hip(in)" = "Hip.inch.",
         "Waist(in)" = "Waist.inch.",
         "Waist-Hip_Ratio" = "Waist.Hip.Ratio",
         "TSH(mIU/L)" = "TSH..mIU.L.",
         "AMH(ng/mL)" = "AMH.ng.mL.",
         "PRL(ng/mL)" = "PRL.ng.mL.",
         "Vit_D3(ng/mL)" = "Vit.D3..ng.mL.",
         "PRG(ng/mL)" = "PRG.ng.mL.",
         "RBS(mg/dl)" = "RBS.mg.dl.",
         "Weight_gain" = "Weight.gain.Y.N.",
         "Hair_growth" = "hair.growth.Y.N.",
         "Skin_darkening" = "Skin.darkening..Y.N.",
         "Hair_loss" = "Hair.loss.Y.N.",
         "Pimples" = "Pimples.Y.N.",
         "Fast_food" = "Fast.food..Y.N.",
         "Reg_Exercise" = "Reg.Exercise.Y.N.",
         "BP_Systolic(mmHg)" = "BP._Systolic..mmHg.",
         "BP_Diastolic(mmHg)" = "BP._Diastolic..mmHg.",
         "Follicle_No(L)" = "Follicle.No...L.",
         "Follicle_No(R)" = "Follicle.No...R.",
         "Avg_F_size(L)(mm)" = "Avg..F.size..L...mm.",
         "Avg_F_size(R)(mm)" = "Avg..F.size..R...mm.",
         "Endometrium(mm)" = "Endometrium..mm.")
```

$~$

After making the first part of addressing the column names, the results are seen below of the merged datasets: 

```{r, echo=FALSE, kable.opts=list(caption="data frame is now printed using `kable`.")}
# merge data sets
pcos_data <- merge(pcos, pcos2,  by=c("Sl.No"))
pcos_data %>% 
kable(format = "html", col.names = colnames(pcos_data)) %>%
  kable_styling() %>%
  kableExtra::scroll_box(width = "100%", height = "400px")
```

$~$

For part 2, I tackled the missing values by first transforming `Height` from cm to m, calculate `BMI`, `Waist-hip ratio`  and `FSH/LH`. Then after careful consideration to the data, I decided to use the median number to replace the missing values in `Marriage_Status(yrs)`, `AMH(ng/mL)` and `Fast_food` since it didn't disrupt the data's distribution. 
```{r, echo=FALSE, warning=FALSE}
# convert Height from cm to
pcos_data$"Height(cm)" <- round((pcos_data$"Height(cm)" * 0.01),1)

# convert hip and waist from inches to cm
pcos_data$`Hip(in)` <- round((pcos_data$`Hip(in)` * 2.54),1)
pcos_data$`Waist(in)` <- round((pcos_data$`Waist(in)` * 2.54),1)

# renaming variables
pcos_data <- pcos_data %>% 
  rename("Height(m)" = "Height(cm)",
         "Hip(cm)" = "Hip(in)",
         "Waist(cm)" = "Waist(in)")

# calculate BMI
pcos_data$BMI <- round((pcos_data$"Weight(kg)" / pcos_data$"Height(m)"^2), 1)

# calculate waist-hip ratio
pcos_data$"Waist-Hip_Ratio" <- round((pcos_data$"Waist(cm)" / pcos_data$"Hip(cm)"),2)

# calculate FSH/LH
pcos_data$"FSH-LH" <- round((pcos_data$"FSH(mIU/mL)"/pcos_data$"LH(mIU/mL)"),2)

# calculate Married years
pcos_data$"Married(yrs)"[is.na(pcos_data$"Married(yrs)")] <- median(pcos_data$"Married(yrs)", na.rm = T)

# calculate Fast food
pcos_data$"Fast_food"[is.na(pcos_data$"Fast_food")] <- median(pcos_data$"Fast_food", na.rm = T)

# calculate 
pcos_data$"AMH(ng/mL)"[is.na(pcos_data$"AMH(ng/mL)")] <- median(pcos_data$"AMH(ng/mL)", na.rm = T)

# List of variables to round
vars_to_round <- c("Hb(g/dl)", "Married(yrs)", "Ibeta-HCG(mIU/mL)", "IIbeta-HCG(mIU/mL)", 
                   "FSH(mIU/mL)", "LH(mIU/mL)", "FSH-LH", "TSH(mIU/L)", "AMH(ng/mL)", "PRL(ng/mL)", 
                   "Vit_D3(ng/mL)", "PRG(ng/mL)", "Avg_F_size(R)(mm)", "Endometrium(mm)")

# Rounding the variables to 1 decimal places
pcos_data <- pcos_data %>%
  mutate_at(vars(vars_to_round), ~ round(., digits = 1))


# remove 1st column
pcos_cleaned <- pcos_data[-1]
```

$~$

The final results are seen in `pcos_cleaned` below:
```{r,echo=FALSE}
pcos_cleaned %>% 
kable(format = "html", col.names = colnames(pcos_cleaned)) %>%
  kable_styling() %>%
  kableExtra::scroll_box(width = "100%", height = "400px")
```

$~$

Once more, I generated a `DataExplorer` histogram to inspect the impact of the alterations on the distribution. While more variables have been included in the distribution, there isn't a consistent pattern; each variable demonstrates variations, displaying either a normal distribution, right-skewed, left-skewed, or no discernible pattern.

```{r, fig.height = 10, fig.width = 10, echo=FALSE, fig.align='center', warning=FALSE, eval=TRUE, message=FALSE}
DataExplorer::plot_histogram(
  geom_histogram_args = list(alpha = 1, fill = "dark blue"),
   data = pcos_cleaned,
         ggtheme=theme_ipsum())
```

$~$

The correlation plot below is measuring the degree of linear relationship within the dataset. The values in which this is measured falls between -1 and +1, with +1 being a strong positive correlation and -1 a strong negative correlation. The darker the dot the more strongly correlated (whether positive or negative). Based on the findings below, there aren't many variables that exhibit a notably strong positive or negative correlation, although some variables do fall within these categories to some extent.

Some notable correlations are as follows:

* Positive correlations between: `Weight(kg)` and `BMI`, `Married(yrs)` and `Age(yrs)`, `Follicle_No(L)`, `Follicle_No(R)` and `PCOS(Y/N)` to name a few.

* Negative correlations between: 

```{r, fig.height=8, fig.width=10, warning=FALSE, echo=FALSE, message=FALSE}
# Selecting only the numerical variables for correlation
numerical_data <- pcos_cleaned[, sapply(pcos_cleaned, is.numeric)]

# Calculating the correlation matrix
cor_matrix <- cor(numerical_data)

# Print the correlation matrix
corrplot(cor_matrix, method = "color", type = "lower", 
         tl.col = "black", tl.cex = 0.5)
```

```{r, fig.height=18, fig.width=10, warning=FALSE, echo=FALSE, message=FALSE, fig.align='center'}

# # boxplot of the variables with the outlier parameters
# pcos_df2 <- pcos_cleaned %>%
#                 gather(variable, values, 1:dim(pcos_cleaned)[2])
# pcos_df2 %>%
#   ggplot() +
#   geom_boxplot(aes(x = variable, y = values)) +
#   facet_wrap(~variable, ncol = 4, scales = "free") +
#   theme_ipsum() +
#     theme(
#       plot.title = element_text(size=6)
#     )
```


```{r, echo=FALSE}

# # Separate the target variable
# target <- pcos_df$PCOS
# predictors <- pcos_df[, -which(names(pcos_df) == "PCOS")]
# 
# # Apply outlier treatment to predictors
# # Example: Using Winsorization for outlier treatment
# 
# predictors_cleaned <- predictors %>%
#   mutate_all(~ifelse(. < quantile(., 0.05), quantile(., 0.05),
#                      ifelse(. > quantile(., 0.95), quantile(., 0.95), .)))
# 
# # Reconstruct the dataset with cleaned predictors and the original target variable
# pcos_df_cleaned <- cbind(predictors_cleaned, PCOS = target)
# 
# # Use 'data_cleaned' for model training while keeping the original target variable unchanged
```


$~$

Let's now examine the impact of incorporating parameters for outliers in each variable through a boxplot. The initial observation reveals a notable decrease in outliers, particularly noticeable within the variables.

```{r, fig.height=18, fig.width=10, warning=FALSE, echo=FALSE, message=FALSE, fig.align='center'}

# # boxplot of the variables with the outlier parameters
# pcos_df2 <- pcos_df_cleaned %>%
#                 gather(variable, values, 1:dim(pcos_df_cleaned)[2])
# pcos_df2 %>%
#   ggplot() +
#   geom_boxplot(aes(x = variable, y = values)) +
#   facet_wrap(~variable, ncol = 4, scales = "free") +
#   theme_ipsum() +
#     theme(
#       plot.title = element_text(size=6)
#     )
```


### Model Building:

```{r,echo=FALSE}
# create some random numbers for reproduction
set.seed(29)

# Cross Validation Set-up
inTrain <- createDataPartition(pcos_cleaned$`PCOS(Y/N)`, p=.75, list = F)
train <- pcos_cleaned[inTrain,]
valid <- pcos_cleaned[-inTrain,]
```


#### Decision Tree (rpart):

```{r, echo=FALSE}
# create the decision tree
rpart_model <- rpart(`PCOS(Y/N)` ~ ., method = "class", data = train)

# display the decision tree
prp(rpart_model, extra=1, faclen=0,  nn=T, box.palette="Blues")
```

```{r,echo=FALSE}
# creating our prediction
rpart_result <- predict(rpart_model, newdata = valid[, !colnames(valid) %in% "PCOS(Y/N)"], type = 'class')

# confusion matrix
confusionMatrix(rpart_result, as.factor(valid$`PCOS(Y/N)`))
```

```{r, echo=FALSE}
# contribution of variables
varImp(rpart_model) %>% kable()
```

```{r, echo=FALSE}
# Extract accuracy from the confusion matrix
accuracy_rpart <- confusionMatrix(rpart_result, as.factor(valid$`PCOS(Y/N)`))$overall["Accuracy"]
kable(accuracy_rpart, align = "l")
```
```{r, echo=FALSE}
# creating the second dataset from the original
pcos_cleaned2 <- pcos_cleaned %>%
  select(`PCOS(Y/N)`, `Follicle_No(R)`, `Follicle_No(L)`, `Weight_gain`, `Skin_darkening`, `Hair_growth`)

# create some random number for reproduction
set.seed(28)

# Cross Validation Set-up
inTrain2 <- createDataPartition(pcos_cleaned2$`PCOS(Y/N)`, p=.75, list = F)
train2 <- pcos_cleaned2[inTrain2,]
valid2 <- pcos_cleaned2[-inTrain2,]

# create the decision tree
rpart_model2 <- rpart(`PCOS(Y/N)` ~ ., method = "class", data = train2)

# display the decision tree
prp(rpart_model2, extra=1, faclen=0,  nn=T, box.palette="Blues")
```


The confusion matrix and statistics for the third decision tree:
```{r, echo=FALSE}
# creating our prediction
rpart_result2 <- predict(rpart_model2, newdata = valid2[, !colnames(valid2) %in% "PCOS(Y/N)"], type = 'class')

# creating the third confusion matrix
confusionMatrix(rpart_result2, as.factor(valid2$`PCOS(Y/N)`))
```

Let's look at the contribution of each variable for the third dataset:
```{r, echo=FALSE}
# contribution of variables
varImp(rpart_model2) %>% kable()
```


and now for the accuracy of 58.4% which is higher than the first and second decision tree models:
```{r, echo=FALSE}
# Extract accuracy from the confusion matrix
accuracy_rpart2 <- confusionMatrix(rpart_result2, as.factor(valid2$`PCOS(Y/N)`))$overall["Accuracy"]
kable(accuracy_rpart2, align = "l")
```



#### Random Forest (randomForest):

```{r, echo=FALSE}
# create some random number for reproduction
# set.seed(30)
# 
# # create random forest model using the training data
# rf_model <- randomForest(`PCOS(Y/N)`~., train)
# rf_model
# 
# # prediction
# rf_result <- predict(rf_model, newdata = valid[, !colnames(valid) %in% "PCOS(Y/N)"])
# 
# # confusion matrix
# confusionMatrix(rf_result, valid$`PCOS(Y/N)`)
```

```{r, echo=FALSE}
# plot for rf_model
# varImpPlot(rf_model)
```

```{r, echo=FALSE}
# Extract accuracy from the confusion matrix for the rf_model
# accuracy_rf <- confusionMatrix(rf_result, valid$`PCOS(Y/N)`)$overall["Accuracy"]
# accuracy_rf
```


#### Gradient Boosting Machines (xgboost or gbm):

```{r, echo=FALSE}

```

```{r, echo=FALSE}

```

```{r, echo=FALSE}

```

```{r, echo=FALSE}

```

```{r, echo=FALSE}

```

#### Support Vector Machines (e1071):

```{r, echo=FALSE}
# create some random numbers for reproduction
# set.seed(31)
# 
# # SVM
# svm_model <- svm(`PCOS(Y/N)` ~ ., train)
# 
# # create prediction
# svm_result <- predict(svm_model, newdata = valid)
# 
# # confusion matrix for svm
# confusionMatrix(svm_result, as.factor(valid$PCOS(Y/N)))
```

```{r, echo=FALSE}
# summary(svm_result)
```

```{r, echo=FALSE}
# Extract accuracy from the confusion matrix
# accuracy_svm <- confusionMatrix(svm_result, as.factor(valid$PCOS(Y/N)))$overall["Accuracy"]
# accuracy_svm
```


```{r, echo=FALSE}

```


#### Neural Networks (neuralnet):

```{r, echo=FALSE}

```

```{r, echo=FALSE}

```

```{r, echo=FALSE}

```

```{r, echo=FALSE}

```

#### K-Nearest Neighbors (kknn or class):

```{r, echo=FALSE}

```

```{r, echo=FALSE}

```

```{r, echo=FALSE}

```

```{r, echo=FALSE}

```

```{r, echo=FALSE}

```

### Model Comparison:

Lastly, let's do a model comparison for Decision Tree, Random Forest and SVM:
```{r, echo=FALSE}
# Compare models
# model_names <- c("Decision Tree","Random Forest", "SVM")
# accuracies <- c(0.5843829, 0.7128463, 0.6372796)
# results <- data.frame(Model = model_names, Accuracy = accuracies)
# results <- results[order(results$Accuracy, decreasing = TRUE), ]
# results
```


### Conclusion:


### References:





