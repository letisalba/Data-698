---
title: "Data 698 - Final Project"
author: "Leticia Salazar"
date: "May 17, 2023"
output:
  html_document:
    theme: united
    highlight: kate
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

$~$

# Polycystic Ovarian Syndrome (PCOS)

$~$

## Overview: 

Polycystic Ovary Syndrome (PCOS) is a complex hormonal disorder that affects people with ovaries, typically during their reproductive years. It's one of the most common endocrine disorders among women of childbearing age, affecting approximately 1 in 10 individuals. Affecting 4% - 20% of women worldwide, it's believed that PCOS affects womens bodies physically and emotionally along with their metabolism and overall health and appearance. PCOS causes problems in ovaries making it hard for women to have a healthy menstrual cycle leading to the development of cysts and infertility. Although very common in women of reproductive age, PCOS may begin shortly after puberty but can also develop during the later teenage years and early adulthood.


$~$

Hormones that are involved in PCOS are:

* **Androgens: ** aka "male hormones" are present in women with PCOS at higher levels than usual. Excess in androgens can cause symptoms such as acne, unwanted hair, thinning hair, and irregular periods.

* **Insulin: ** allows the body to absorb glucose (blood sugar) into the cells for energy. In PCOS, the body doesn't respond to insulin as intended therefore, elevations in blood glucose levels can be assessed. Such elevations then lead to increased production of androgen.

* **Progesterone: ** vital hormone for menstruation and pregnancy; lack of progesterone contributes to irregular periods.

$~$

PCOS Symptoms:

Many of these symptoms can be attributed to other causes or go unnoticed but it is very common for PCOS to go undiagnosed for some time. Here are some symptoms that help with the diagnosis:

* **Irregular periods: ** irregular or missed periods as are a result of not ovulating is a common signs of PCOS

* **Polycystic ovaries: ** some may develop cysts in their ovaries but some don't. Ovaries may be enlarged and follicles surrounding their eggs therefore failing to function regularly.

* **Excess androgen: ** elevated levels of male hormones can cause excess hair and acne.

$~$

Other symptoms may include:

* **Weight gain: ** many people with PCOS will have weight gain or obesity that is difficult to manage.

* **Fatigue: ** increase in fatigue or low energy is also common

* **Unwanted hair growth: ** due to excess androgen, areas such as face, arms, back, chest, hand, toes and abdomen may have excess hair growth.

* **Thinning hair on the head: ** hair loss may increase in middle age for those with PCOS

* **Infertility: ** PCOS is a leading cause for infertility but not everyone is the same.

* **Acne: ** due to hormonal changes, acne can be arise and make skin oilier than usual and cause breakout in the face, chest and upper back.

* **Darkening of skin: ** areas such as under arms, breasts or back of your neck may get dark, patchy or thicken

* **Mood changes: ** mood swings, depression and anxiety can increase

* **Pelvic pain: ** pain may occur with periods along with heavy bleeding or without bleeding

* **Headaches: ** can occur due to hormonal changes

* **Sleep problems: ** most people often suffer with problem such as insomnia or poor sleep. These arise due to many factors but a common one is having sleep apnea (sleep disorder). Even when you fall asleep you wake up as if you have not slept at all or have trouble falling asleep.

* **Depression: ** can arise due to symptoms that can alter your appearance and have a negative impact on your emotions.

**It's good to note that not everyone who is diagnosed with PCOS experiences all of these symptoms and should always consult with a their PCP or OBGYN to get an accurate diagnosis.**

$~$ 

### The Data:

I am using 10 different data sets for this project to understand the difference between PCOS and non-PCOS women. Below is a description the datasets with the variables of interest for each:

* Data sets labeled as `pcos` and `pcos2` were obtained from [Kaggle.com](https://www.kaggle.com/datasets/prasoonkottarathil/polycystic-ovary-syndrome-pcos) called Polycystic ovary syndrome (PCOS) where it collected data from 10 different hospital across Kerala, India. The dataset contains all physical and clinical parameters to determine PCOS and infertility related issues.


Things to consider and understand the data set:

* Units used are feet to cm
* For Yes | No questions
  * Yes = 1
  * No = 0
* Blood Groups:
  * A+ = 11
  * A- = 12
  * B+ = 13
  * B- = 14
  * O+ = 15
  * O- = 16
  * AB+ = 17
  * AB- = 18
* RBS means Random glucose test
* PRG means PCOS related genes
* Blood pressure entered as systolic and diastolic separately
* Beta-HCG cases are mentioned as Case I and II: these are pregnancy hormones
  * The detection of beta hCG (Case I) shows more accuracy in pregnancy test than the hCG (Case II) detection test.
* AMH(ng/mL) detects ovarian reserve (egg count)
* RR(breathes/min) is respiration rates
* Hb(g/dl) is hemoglobin levels that measures how much hemoglobin is in your blood.
* FSH is follicle stimulating hormone
  * FSH helps control the menstrual cycle and stimulates the growth of eggs in the ovaries. FSH levels in women change throughout the menstrual cycle, with the highest levels happening just before an egg is released by the ovary. 
* LH is luteinizing hormone (increases during ovulation)
  * Before menopause - 5 to 25 IU/L
  * Level peaks even higher around the middle of the menstrual cycle
  * Level then becomes higher after menopause - 14.2 to 52.3 IU/L
* TSH is thyroid stimulating hormone
  * levels too high or low may be a sign of thyroid problem
* PRL is prolactin in blood
  * causes the breasts to grow and make milk during pregnancy and after birth. Prolactin levels are normally high for pregnant women and new mothers. Levels are normally low for nonpregnant women and for men.
* Cycle(R/I) values are as follows:
  * 4 indicates irregular menstrual cycle
  * 2 indicates a regular menstrual cycle
  
----------------------------------------------

* Data set `pcos3` was obtained from [Figshare.com](https://figshare.com/articles/dataset/PCOS_DATA_xlsx/17103995?file=31627232) which is a repository where users can make all of their research outputs available in a citable, shareable and discoverable manner.

Variables in our dataset:

* Age	- age of participants
* Family history	- whether patient has family with pcos or not
* Regulation of menstrual cycle	- whether patient has a regular menstrual cycle or not
* BMI	- body mass index
* LH	- luteinizing hormone (increases during ovulation)
* FSH	- follicle stimulating hormone
* LH:FSH ratio	- women without pcos, the ratio between LH and FSH usually lies between  1 and 2 while those with pcos, this ratio becomes reversed, and it might reach as high as 2 or 3
* LH:FSH ratio group	- whether ratio fell above or below 1
* Total Testesterone ng/dL	- total testosterone level
* anti mullein's hormone - levels correspond to the number of eggs you have or your ovarian reserve

----------------------------------------------

* Data sets `pcos4`, `pcos5`, `pcos6`, and `pcos7` were obtained from [Mendeley Data](https://data.mendeley.com/datasets/mh94mxn3nh). These datasets provides the results of an untargeted metabolomic survey was conducted on the metabolites in the FF of 35 patients with PCOS and 37 age-matched individuals as control.

Variables in the data sets include:

* Case No. - 
* Age	- age of participant
* Height (m) - height of participant
* Weight (kg)	- weight of participant
* BMI	- body mass index
* Estrous cyclicity	- the period from one ovulation to a subsequent ovulation
* Ovarian morphology	- whether or not pcos is present
* Serum testosterone (ng/ml) - testosterone levels

----------------------------------------------

* Data set `pcos8` was obtained from [Marquette University](https://epublications.marquette.edu/data_nfp/7/) that provides information of women without PCOS and their menstrual cycle.


----------------------------------------------

* Data set `pcos9` was 

----------------------------------------------



----------------------------------------------



$~$

### Load Libraries:

These are the libraries used to explore, prepare and visualize the data
```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(dplyr)
library(DataExplorer)
library(hrbrthemes)
library(ggplot2)
library(gridExtra)
library(plotly)
```

$~$

### Load data:

I have included the original data sets in my [GitHub](https://github.com/letisalba/Data-698/tree/master/Data-Collection-and-Analysis) account and read from this location. 
```{r, echo=FALSE}
pcos <- read.csv("https://raw.githubusercontent.com/letisalba/Data-698/master/Data-Collection-and-Analysis/csv/PCOS_infertility.csv")

pcos2 <- read.csv("https://raw.githubusercontent.com/letisalba/Data-698/master/Data-Collection-and-Analysis/csv/PCOS_without_infertility.csv")

pcos3 <- read.csv("https://raw.githubusercontent.com/letisalba/Data-698/master/Data-Collection-and-Analysis/csv/pcos_sudan.csv")

pcos4 <- read.csv("https://raw.githubusercontent.com/letisalba/Data-698/master/Data-Collection-and-Analysis/csv/No_PCOS-TableS1.csv")

pcos5 <- read.csv("https://raw.githubusercontent.com/letisalba/Data-698/master/Data-Collection-and-Analysis/csv/No_PCOS-TableS2.csv")

pcos6 <- read.csv("https://raw.githubusercontent.com/letisalba/Data-698/master/Data-Collection-and-Analysis/csv/PCOS-TableS1.csv")

pcos7 <- read.csv("https://raw.githubusercontent.com/letisalba/Data-698/master/Data-Collection-and-Analysis/csv/PCOS-TableS2.csv")

pcos8 <- read.csv("https://raw.githubusercontent.com/letisalba/Data-698/master/Data-Collection-and-Analysis/csv/Menstrual-data.csv")
```


Lets view the data:

`pcos` data:
```{r, echo=FALSE}
# viewing pcos dataset 
head(pcos, 4)
```

`pcos2` data:
```{r, echo=FALSE}
# viewing pcos2 dataset
head(pcos2, 4)
```

$~$

`pcos3` data:
```{r, echo=FALSE}
# viewing pcos3 dataset
head(pcos3, 4)
```

`pcos4` data:
```{r, echo=FALSE}
# viewing pcos4 dataset
head(pcos4, 4)
```

$~$

`pcos5` data:
```{r, echo=FALSE}
# viewing pcos5 dataset
head(pcos5, 4)
```

`pcos6` data:
```{r, echo=FALSE}
# viewing pcos6 dataset
head(pcos6, 4)
```

`pcos7` data:
```{r, echo=FALSE}
# viewing pcos7 dataset
head(pcos7, 4)
```

`pcos8` data:
```{r, echo=FALSE}
# viewing pcos8 dataset
head(pcos8, 4)
```

$~$

`pcos9` data:
```{r, echo=FALSE}
# viewing pcos9 dataset
#head(pcos9, 4)
```

$~$

### Data Exploration:

The first data set `pcos` includes 541 observations and a total of 6 variables. The second data set `pcos2` includes 541 observations and a total of 45 variables. Notice that the column names are not clear enough for readers, this will be tackled in the data preparation section.

$~$

`pcos` data:
```{r, echo=FALSE}
glimpse(pcos)
```

$~$

`pcos2` data:
```{r, echo=FALSE}
glimpse(pcos2)
```

$~$

`pcos3` data:
```{r, echo=FALSE}
glimpse(pcos3)
```

$~$

`pcos4` data:
```{r, echo=FALSE}
glimpse(pcos4)
```

$~$

`pcos5` data:
```{r, echo=FALSE}
glimpse(pcos5)
```

$~$

`pcos6` data:
```{r, echo=FALSE}
glimpse(pcos6)
```

$~$

`pcos7` data:
```{r, echo=FALSE}
glimpse(pcos7)
```

$~$

`pcos8` data:
```{r, echo=FALSE}
glimpse(pcos8)
```





$~$

Let's look at the distribution of our data sets using histograms:

`pcos` data:
```{r, fig.height = 5, fig.width = 10, echo=FALSE, fig.align='center', warning=FALSE, message=FALSE, eval=TRUE}
DataExplorer::plot_histogram(
  geom_histogram_args = list(alpha = 0.5, fill = "red"),
   data = pcos,
         ggtheme=theme_ipsum())
```

$~$

`pcos2` data:
```{r, fig.height = 10, fig.width = 10, echo=FALSE, fig.align='center', warning=FALSE, eval=TRUE}
DataExplorer::plot_histogram(
  geom_histogram_args = list(alpha = 0.5, fill = "purple"),
   data = pcos2,
         ggtheme=theme_ipsum())
```

$~$

`pcos3` data:
```{r, fig.height = 10, fig.width = 10, echo=FALSE, fig.align='center', warning=FALSE, eval=TRUE}
DataExplorer::plot_histogram(
  geom_histogram_args = list(alpha = 0.5, fill = "pink"),
   data = pcos3,
         ggtheme=theme_ipsum())
```


$~$

`pcos4` data:
```{r, fig.height = 10, fig.width = 10, echo=FALSE, fig.align='center', warning=FALSE, eval=TRUE}
DataExplorer::plot_histogram(
  geom_histogram_args = list(alpha = 0.5, fill = "black"),
   data = pcos4,
         ggtheme=theme_ipsum())
```


$~$

`pcos5` data:
```{r, fig.height = 10, fig.width = 10, echo=FALSE, fig.align='center', warning=FALSE, eval=TRUE}
# DataExplorer::plot_histogram(
#   geom_histogram_args = list(alpha = 0.5, fill = "black"),
#    data = pcos5,
#          ggtheme=theme_ipsum())
```


$~$

`pcos6` data:
```{r, fig.height = 10, fig.width = 10, echo=FALSE, fig.align='center', warning=FALSE, eval=TRUE}
DataExplorer::plot_histogram(
  geom_histogram_args = list(alpha = 0.5, fill = "blue"),
   data = pcos6,
         ggtheme=theme_ipsum())
```


$~$

`pcos7` data:
```{r, fig.height = 10, fig.width = 10, echo=FALSE, fig.align='center', warning=FALSE, eval=TRUE}
# DataExplorer::plot_histogram(
#   geom_histogram_args = list(alpha = 0.5, fill = "red"),
#    data = pcos7,
#          ggtheme=theme_ipsum())
```


$~$

`pcos8` data:
```{r, fig.height = 10, fig.width = 10, echo=FALSE, fig.align='center', warning=FALSE, eval=TRUE}
DataExplorer::plot_histogram(
  geom_histogram_args = list(alpha = 0.5, fill = "yellow"),
   data = pcos8,
         ggtheme=theme_ipsum())
```

$~$

Checking for missing data:
```{r, echo=FALSE}
# missing data
colSums(is.na(pcos3))
```
$~$

Checking for missing data:
```{r, echo=FALSE}
# missing data
colSums(is.na(pcos4))
```

$~$

Checking for missing data:
```{r, echo=FALSE}
# missing data
colSums(is.na(pcos5))
```

$~$

Checking for missing data:
```{r, echo=FALSE}
# missing data
colSums(is.na(pcos6))
```

$~$

Checking for missing data:
```{r, echo=FALSE}
# missing data
colSums(is.na(pcos7))
```

$~$

Checking for missing data:

NOT USING `pcos8` BECAUSE OF THE MISSING VALUES!
```{r, echo=FALSE}
# missing data
colSums(is.na(pcos8))
```




$~$

### Data Preparation:

Before I start the cleaning process I converted the data sets as numeric since the class of some of the variables differ. 
```{r, echo=FALSE, warning=FALSE}
pcos <- mutate_all(pcos, function(x) as.numeric(as.character(x)))
pcos2 <- mutate_all(pcos2, function(x) as.numeric(as.character(x)))
```

$~$

Lets look at the column names of both data sets to be able to start tidying the data:

`pcos`:
```{r, echo=FALSE}
colnames(pcos)
```

$~$

`pcos_infertility`:
```{r,echo=FALSE}
colnames(pcos2)
```

$~$

As mentioned earlier, my data preparation will mainly consist of renaming columns, targeting missing values whether it is by replacing them with a mean, median or mode for `Marriage Status (Yrs)` and `Fast Food (Y/N)` or calculating the values as a whole as its the case of `BMI`, `FSH.LH` and `Waist.Hip.Ratio`. I'll also be converting certain columns to metric, remove columns that are duplicate or not need so that it's easier to manage when I merge my two data sets.

```{r, echo=FALSE}
# removing first two column for `pcos` data
# pcos <- dplyr::select(pcos, -c(1:2)) 
pcos <- dplyr::select(pcos, -c(2))

# renaming columns for `pcos` data
pcos <- pcos %>% 
  rename("Sl.No" = "Sl..No",
         "PCOS" = "PCOS..Y.N.",
         "Ibeta-HCG(mIU/mL)" = "I...beta.HCG.mIU.mL.",
         "IIbeta-HCG(mIU/mL)" = "II....beta.HCG.mIU.mL.",
         "AMH(ng/mL)" = "AMH.ng.mL." )

# removing columns not needed for `pcos_infertility` data
#pcos_infertility <- dplyr::select(pcos_infertility, -c(1:2, 17:18, 26, 45))
pcos2 <- dplyr::select(pcos2, -c(2:3, 17:18, 26, 45))

# renaming columns for `pcos_infertility` data
pcos2 <- pcos2 %>% 
  rename("Sl.No" = "Sl..No",
         "Age(yrs)" = "Age..yrs.",
         "Weight(kg)" = "Weight..Kg.",
         "Height(cm)" = "Height.Cm.",
         "Blood_Group" = "Blood.Group", 
         "Pulse rate(bpm)" = "Pulse.rate.bpm.",
         "RR(breaths/min)" = "RR..breaths.min.",
         "Hb(g/dl)" = "Hb.g.dl.",
         "Cycle(R/I)" = "Cycle.R.I.",
         "Cycle_length(days)" = "Cycle.length.days.",
         "Marriage_Status(yrs)" = "Marraige.Status..Yrs.",
         "Pregnant" = "Pregnant.Y.N.",
         "No_of_abortions" = "No..of.aborptions",
         "FSH(mIU/mL)" = "FSH.mIU.mL.",
         "LH(mIU/mL)" = "LH.mIU.mL.",
         "FSH-LH" = "FSH.LH",
         "Hip(in)" = "Hip.inch.",
         "Waist(in)" = "Waist.inch.",
         "Waist-Hip_Ratio" = "Waist.Hip.Ratio",
         "TSH (mIU/L)" = "TSH..mIU.L.",
         "PRL(ng/mL)" = "PRL.ng.mL.",
         "Vit_D3(ng/mL)" = "Vit.D3..ng.mL.",
         "PRG(ng/mL)" = "PRG.ng.mL.",
         "RBS(mg/dl)" = "RBS.mg.dl.",
         "Weight_gain" = "Weight.gain.Y.N.",
         "hair_growth" = "hair.growth.Y.N.",
         "Skin_darkening" = "Skin.darkening..Y.N.",
         "Hair_loss" = "Hair.loss.Y.N.",
         "Pimples" = "Pimples.Y.N.",
         "Fast_food" = "Fast.food..Y.N.",
         "Reg_Exercise" = "Reg.Exercise.Y.N.",
         "BP_Systolic(mmHg)" = "BP._Systolic..mmHg.",
         "BP_Diastolic(mmHg)" = "BP._Diastolic..mmHg.",
         "Follicle_No(L)" = "Follicle.No...L.",
         "Follicle_No(R)" = "Follicle.No...R.",
         "Avg_F_size(L)(mm)" = "Avg..F.size..L...mm.",
         "Avg_F_size(R)(mm)" = "Avg..F.size..R...mm.",
         "Endometrium(mm)" = "Endometrium..mm.")
```
$~$

Here's the results after part 1 of the preparation process:
```{r, echo=FALSE}
# merge data sets
pcos_data <- merge(pcos, pcos2,  by=c("Sl.No"))
head(pcos_data)
```

$~$

Checking for missing data:
```{r, echo=FALSE}
# missing data
colSums(is.na(pcos_data))
```
$~$

For part 2, I tackled the missing values by first transforming `Height` from cm to m, calculate `BMI`, `Waist-hip ratio`  and `FSH/LH`. Then after careful consideration to the data, I decided to use the median number to replace the missing values in `Marriage_Status(yrs)`, `AMH(ng/mL)` and `Fast_food` since it didn't disrupt the data's distribution.
```{r, echo=FALSE, warning=FALSE}
# convert Height from cm to
pcos_data$"Height(cm)" <- round((pcos_data$"Height(cm)" * 0.01),1)

# convert hip and waist from inches to cm
pcos_data$`Hip(in)` <- round((pcos_data$`Hip(in)` * 2.54),1)
pcos_data$`Waist(in)` <- round((pcos_data$`Waist(in)` * 2.54),1)

# renaming variables
pcos_data <- pcos_data %>% 
  rename("Height(m)" = "Height(cm)",
         "Hip(cm)" = "Hip(in)",
         "Waist(cm)" = "Waist(in)")

# calculate BMI
pcos_data$BMI <- round((pcos_data$"Weight(kg)" / pcos_data$"Height(m)"^2), 1)

# calculate waist-hip ratio
pcos_data$"Waist-Hip_Ratio" <- round((pcos_data$"Waist(cm)" / pcos_data$"Hip(cm)"),2)

# calculate FSH/LH
pcos_data$"FSH-LH" <- round((pcos_data$"FSH(mIU/mL)"/pcos_data$"LH(mIU/mL)"),2)

# calculate Marriage Status
pcos_data$"Marriage_Status(yrs)"[is.na(pcos_data$"Marriage_Status(yrs)")] <- median(pcos_data$"Marriage_Status(yrs)", na.rm = T)

# calculate Fast food
pcos_data$"Fast_food"[is.na(pcos_data$"Fast_food")] <- median(pcos_data$"Fast_food", na.rm = T)

# calculate 
pcos_data$"AMH(ng/mL)"[is.na(pcos_data$"AMH(ng/mL)")] <- median(pcos_data$"AMH(ng/mL)", na.rm = T)

# remove 1st column
pcos_data <- pcos_data[-1]
```

$~$

After tidying up the data, below is the final distribution:
```{r, fig.height = 10, fig.width = 10, echo=FALSE, fig.align='center', warning=FALSE, eval=TRUE}
DataExplorer::plot_histogram(
  geom_histogram_args = list(alpha = 0.5, fill = "dark green"),
   data = pcos_data,
         ggtheme=theme_ipsum())
```


```{r, eval=FALSE}
colnames(pcos_data)
```

```{r, echo=FALSE, eval=FALSE}
str(pcos_data)
```
