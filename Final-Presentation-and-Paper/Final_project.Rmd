---
title: "Data 698 - Final Project"
author: "Leticia Salazar"
date: "May 17, 2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### Load Libraries:

These are the libraries used to explore, prepare and visualize the data
```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(dplyr)
library(DataExplorer)
library(hrbrthemes)
library(ggplot2)
library(gridExtra)
library(shiny)
library(plotly)
library(shinythemes)
```

$~$

### Load data:

Below is a short description of the variables of interest in the data sets:

* The data sets I will be using are from [Kaggle](https://www.kaggle.com/datasets/prasoonkottarathil/polycystic-ovary-syndrome-pcos) collected from 10 different hospital across Kerala, India.


Things to consider and understand the data set:

* Units used are feet to cm
* For Yes | No questions
  * Yes = 1
  * No = 0
* Blood Groups:
  * A+ = 11
  * A- = 12
  * B+ = 13
  * B- = 14
  * O+ = 15
  * O- = 16
  * AB+ = 17
  * AB- = 18
* RBS means Random glucose test
* PRG means PCOS related genes
* Blood pressure entered as systolic and diastolic separately
* Beta-HCG cases are mentioned as Case I and II: these are pregnancy hormones
  * The detection of beta hCG (Case I) shows more accuracy in pregnancy test than the hCG (Case II) detection test.
* AMH(ng/mL) detects ovarian reserve (egg count)
* RR(breathes/min) is respiration rates
* Hb(g/dl) is hemoglobin levels that measures how much hemoglobin is in your blood.
* FSH is follicle stimulating hormone
  * FSH helps control the menstrual cycle and stimulates the growth of eggs in the ovaries. FSH levels in women change throughout the menstrual cycle, with the highest levels happening just before an egg is released by the ovary. 
* LH is luteinizing hormone (increases during ovulation)
  * Before menopause - 5 to 25 IU/L
  * Level peaks even higher around the middle of the menstrual cycle
  * Level then becomes higher after menopause - 14.2 to 52.3 IU/L
* TSH is thyroid stimulating hormone
  * levels too high or low may be a sign of thyroid problem
* PRL is prolactin in blood
  * causes the breasts to grow and make milk during pregnancy and after birth. Prolactin levels are normally high for pregnant women and new mothers. Levels are normally low for nonpregnant women and for men.
* Cycle(R/I) values are as follows:
  * 4 indicates irregular menstrual cycle
  * 2 indicates a regular menstrual cycle

$~$

I have included the original data sets in my [GitHub](https://github.com/letisalba/Data_608/tree/master/Final%20Project/csv) account and read from this location. 
```{r, echo=FALSE}
pcos <- read.csv("https://raw.githubusercontent.com/letisalba/DATA_608/master/Final%20Project/csv/PCOS_infertility.csv")
pcos_infertility <- read.csv("https://raw.githubusercontent.com/letisalba/DATA_608/master/Final%20Project/csv/PCOSData_without_infertility.csv")
```


Lets view the `pcos` data:
```{r, echo=FALSE}
head(pcos, 4)
```

... And the `pcos_infertility` data:
```{r, echo=FALSE}
head(pcos_infertility, 4)
```

$~$

### Data Exploration:

The first data set `pcos` includes 541 observations and a total of 6 variables. The second data set `pcos_infertility` includes 541 observations and a total of 45 variables. Notice that the column names are not clear enough for readers, this will be tackled in the data preparation section.

$~$

The `pcos` data:
```{r, echo=FALSE}
glimpse(pcos)
```

$~$

The `pcos_infertility` data:
```{r, echo=FALSE}
glimpse(pcos_infertility)
```

$~$

Let's look at the distribution of our data sets using histograms:

`pcos` data:
```{r, fig.height = 5, fig.width = 10, echo=FALSE, fig.align='center', warning=FALSE, message=FALSE, eval=TRUE}
DataExplorer::plot_histogram(
  geom_histogram_args = list(alpha = 0.5, fill = "red"),
   data = pcos,
         ggtheme=theme_ipsum())
```

$~$

`pcos_infertility` data:
```{r, fig.height = 10, fig.width = 10, echo=FALSE, fig.align='center', warning=FALSE, eval=TRUE}
DataExplorer::plot_histogram(
  geom_histogram_args = list(alpha = 0.5, fill = "purple"),
   data = pcos_infertility,
         ggtheme=theme_ipsum())
```


$~$

### Data Preparation:

Before I start the cleaning process I converted the data sets as numeric since the class of some of the variables differ. 
```{r, echo=FALSE, warning=FALSE}
pcos <- mutate_all(pcos, function(x) as.numeric(as.character(x)))
pcos_infertility <- mutate_all(pcos_infertility, function(x) as.numeric(as.character(x)))
```

$~$

Lets look at the column names of both data sets to be able to start tidying the data:

`pcos`:
```{r, echo=FALSE}
colnames(pcos)
```

$~$

`pcos_infertility`:
```{r,echo=FALSE}
colnames(pcos_infertility)
```

$~$

As mentioned earlier, my data preparation will mainly consist of renaming columns, targeting missing values whether it is by replacing them with a mean, median or mode for `Marriage Status (Yrs)` and `Fast Food (Y/N)` or calculating the values as a whole as its the case of `BMI`, `FSH.LH` and `Waist.Hip.Ratio`. I'll also be converting certain columns to metric, remove columns that are duplicate or not need so that it's easier to manage when I merge my two data sets.

```{r, echo=FALSE}
# removing first two column for `pcos` data
# pcos <- dplyr::select(pcos, -c(1:2)) 
pcos <- dplyr::select(pcos, -c(2))

# renaming columns for `pcos` data
pcos <- pcos %>% 
  rename("Sl.No" = "Sl..No",
         "PCOS" = "PCOS..Y.N.",
         "Ibeta-HCG(mIU/mL)" = "I...beta.HCG.mIU.mL.",
         "IIbeta-HCG(mIU/mL)" = "II....beta.HCG.mIU.mL.",
         "AMH(ng/mL)" = "AMH.ng.mL." )

# removing columns not needed for `pcos_infertility` data
#pcos_infertility <- dplyr::select(pcos_infertility, -c(1:2, 17:18, 26, 45))
pcos_infertility <- dplyr::select(pcos_infertility, -c(2:3, 17:18, 26, 45))

# renaming columns for `pcos_infertility` data
pcos_infertility <- pcos_infertility %>% 
  rename("Sl.No" = "Sl..No",
         "Age(yrs)" = "Age..yrs.",
         "Weight(kg)" = "Weight..Kg.",
         "Height(cm)" = "Height.Cm.",
         "Blood_Group" = "Blood.Group", 
         "Pulse rate(bpm)" = "Pulse.rate.bpm.",
         "RR(breaths/min)" = "RR..breaths.min.",
         "Hb(g/dl)" = "Hb.g.dl.",
         "Cycle(R/I)" = "Cycle.R.I.",
         "Cycle_length(days)" = "Cycle.length.days.",
         "Marriage_Status(yrs)" = "Marraige.Status..Yrs.",
         "Pregnant" = "Pregnant.Y.N.",
         "No_of_abortions" = "No..of.aborptions",
         "FSH(mIU/mL)" = "FSH.mIU.mL.",
         "LH(mIU/mL)" = "LH.mIU.mL.",
         "FSH-LH" = "FSH.LH",
         "Hip(in)" = "Hip.inch.",
         "Waist(in)" = "Waist.inch.",
         "Waist-Hip_Ratio" = "Waist.Hip.Ratio",
         "TSH (mIU/L)" = "TSH..mIU.L.",
         "PRL(ng/mL)" = "PRL.ng.mL.",
         "Vit_D3(ng/mL)" = "Vit.D3..ng.mL.",
         "PRG(ng/mL)" = "PRG.ng.mL.",
         "RBS(mg/dl)" = "RBS.mg.dl.",
         "Weight_gain" = "Weight.gain.Y.N.",
         "hair_growth" = "hair.growth.Y.N.",
         "Skin_darkening" = "Skin.darkening..Y.N.",
         "Hair_loss" = "Hair.loss.Y.N.",
         "Pimples" = "Pimples.Y.N.",
         "Fast_food" = "Fast.food..Y.N.",
         "Reg_Exercise" = "Reg.Exercise.Y.N.",
         "BP_Systolic(mmHg)" = "BP._Systolic..mmHg.",
         "BP_Diastolic(mmHg)" = "BP._Diastolic..mmHg.",
         "Follicle_No(L)" = "Follicle.No...L.",
         "Follicle_No(R)" = "Follicle.No...R.",
         "Avg_F_size(L)(mm)" = "Avg..F.size..L...mm.",
         "Avg_F_size(R)(mm)" = "Avg..F.size..R...mm.",
         "Endometrium(mm)" = "Endometrium..mm.")
```
$~$

Here's the results after part 1 of the preparation process:
```{r, echo=FALSE}
# merge data sets
pcos_data <- merge(pcos, pcos_infertility,  by=c("Sl.No"))
head(pcos_data)
```

$~$

Checking for missing data:
```{r, echo=FALSE}
# missing data
colSums(is.na(pcos_data))
```
$~$

For part 2, I tackled the missing values by first transforming `Height` from cm to m, calculate `BMI`, `Waist-hip ratio`  and `FSH/LH`. Then after careful consideration to the data, I decided to use the median number to replace the missing values in `Marriage_Status(yrs)`, `AMH(ng/mL)` and `Fast_food` since it didn't disrupt the data's distribution.
```{r, echo=FALSE, warning=FALSE}
# convert Height from cm to m
pcos_data$"Height(cm)" <- round((pcos_data$"Height(cm)" * 0.01),1)

# convert hip and waist from inches to cm
pcos_data$`Hip(in)` <- round((pcos_data$`Hip(in)` * 2.54),1)
pcos_data$`Waist(in)` <- round((pcos_data$`Waist(in)` * 2.54),1)

# renaming variables
pcos_data <- pcos_data %>% 
  rename("Height(m)" = "Height(cm)",
         "Hip(cm)" = "Hip(in)",
         "Waist(cm)" = "Waist(in)")

# calculate BMI
pcos_data$BMI <- round((pcos_data$"Weight(kg)" / pcos_data$"Height(m)"^2), 1)

# calculate waist-hip ratio
pcos_data$"Waist-Hip_Ratio" <- round((pcos_data$"Waist(cm)" / pcos_data$"Hip(cm)"),2)

# calculate FSH/LH
pcos_data$"FSH-LH" <- round((pcos_data$"FSH(mIU/mL)"/pcos_data$"LH(mIU/mL)"),2)

# calculate Marriage Status
pcos_data$"Marriage_Status(yrs)"[is.na(pcos_data$"Marriage_Status(yrs)")] <- median(pcos_data$"Marriage_Status(yrs)", na.rm = T)

# calculate Fast food
pcos_data$"Fast_food"[is.na(pcos_data$"Fast_food")] <- median(pcos_data$"Fast_food", na.rm = T)

# calculate 
pcos_data$"AMH(ng/mL)"[is.na(pcos_data$"AMH(ng/mL)")] <- median(pcos_data$"AMH(ng/mL)", na.rm = T)

# remove 1st column
pcos_data <- pcos_data[-1]
```

$~$

After tidying up the data, below is the final distribution:
```{r, fig.height = 10, fig.width = 10, echo=FALSE, fig.align='center', warning=FALSE, eval=TRUE}
DataExplorer::plot_histogram(
  geom_histogram_args = list(alpha = 0.5, fill = "dark green"),
   data = pcos_data,
         ggtheme=theme_ipsum())
```


```{r, echo=FALSE, eval=FALSE}
colnames(pcos_data)
```

```{r, echo=FALSE, eval=FALSE}
str(pcos_data)
```
